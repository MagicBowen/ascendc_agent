# 问题记录

本文档系统性地记录了在 Ascend C 算子开发 Agent 原型验证过程中识别出的各类问题，包括技术挑战、工程限制和优化机会。

## 1. 文档与知识库挑战

### 1.1 文档可访问性
- **问题描述**：华为官方在线文档由于反爬虫机制或权限要求，无法通过 WebFetch/WebSearch 被 Agent 直接访问
- **影响**：Agent 无法实时获取最新的 API 文档和开发指南
- **潜在解决方案**：
  - 建立本地化文档镜像
  - 开发专用的文档 MCP 服务
  - 与华为合作获取 API 访问权限

### 1.2 文档碎片化
- **问题描述**：Ascend C 基础 API 文档分散在多个页面和章节中，缺乏统一的 API 参考手册
- **影响**：Agent 需要浏览大量内容才能找到所需信息，增加开发复杂度
- **改进建议**：
  - 创建统一的 API 索引文档
  - 开发智能文档检索系统
  - 建立 API 分类和标签体系

### 1.3 文档组织混乱
- **问题描述**：参考手册内容碎片化，缺乏连贯性，缺少从入门到精通的完整指南
- **影响**：学习曲线陡峭，开发效率低下
- **优化方向**：
  - 重构文档结构，建立清晰的层次关系
  - 提供渐进式学习路径
  - 增加实践案例和最佳实践

### 1.4 本地化需求
- **问题描述**：需要本地化的 markdown 格式 API 手册和工具指南
- **重要性**：提高访问速度，支持离线开发，便于版本控制
- **实施计划**：
  - 定期同步官方文档更新
  - 建立文档版本管理机制
  - 开发文档自动转换工具

### 1.5 图像处理限制
- **问题描述**：在线文档包含大量模型难以处理的图像，缺少类似 mermaid 的 DSL 图表
- **影响**：Agent 无法有效解析架构图和流程图
- **解决方案**：
  - 开发图像转文本描述工具
  - 推广使用标准化的图表语言
  - 建立图表库和说明文档

## 2. 开发环境与工具链问题

### 2.1 文档不一致性
- **问题描述**：文档中的示例代码与之前提到的环境版本和构建方法存在冲突
- **具体表现**：版本号不匹配，构建命令过时，依赖关系不明确
- **改进措施**：
  - 建立文档版本控制机制
  - 提供版本兼容性矩阵
  - 定期验证示例代码可用性

### 2.2 初始示例问题
- **问题描述**：第一个 "hello world" 示例无法编译；文档包含错误且缺乏版本对齐
- **影响**：新手入门困难，影响开发体验
- **修复方案**：
  - 验证所有基础示例代码
  - 提供详细的错误排查指南
  - 建立示例代码测试流水线

### 2.3 复杂工程模式
- **问题描述**：多种工程模式（直接调用、自定义项目、ACLNN）和构建方法（毕昇插件、新旧 CMake 项目）造成混淆
- **挑战**：选择困难，配置复杂，维护成本高
- **简化策略**：
  - 提供模式选择指南
  - 开发统一的构建模板
  - 建立最佳实践推荐

### 2.4 示例仓库过载
- **问题描述**：示例仓库包含过多分散内容，混合了多种工程模式，使 Agent 难以专注
- **优化方案**：
  - 按功能模块重新组织示例
  - 提供清晰的导航和搜索
  - 建立示例分类体系

### 2.5 容器环境设置
- **问题描述**：容器环境需要手动设置环境变量，应该预先配置好
- **改进方向**：
  - 预配置开发环境镜像
  - 提供一键启动脚本
  - 建立环境验证机制

### 2.6 MCP 集成
- **问题描述**：文档应能通过主流的在线文档 MCP（如 context7）访问
- **集成计划**：
  - 评估主流 MCP 文档服务
  - 开发专用 Ascend C MCP
  - 建立文档同步机制

## 3. Agent 工程能力限制

### 3.1 项目类型有限
- **问题描述**：目前仅支持简单的项目类型（独立的核函数实现文件，带有调用 ACL 接口的 main 函数）
- **局限性**：无法处理复杂算子、多核协同、分布式计算等场景
- **扩展计划**：
  - 支持多核算子开发
  - 增加分布式计算模式
  - 开发复杂算子模板

### 3.2 模拟环境限制
- **问题描述**：构建和测试环境使用 Docker 版本，没有真实的 NPU 执行验证
- **影响**：无法验证真实硬件性能，存在环境差异风险
- **解决方案**：
  - 集成云 NPU 测试环境
  - 开发性能模拟工具
  - 建立硬件兼容性测试

### 3.3 算子测试覆盖不足
- **问题描述**：Agent 生成的算子测试用例侧重于简单的向量算子，缺少对边界情况、分块策略、动态形状、立方算子、融合算子以及硬件变体的测试
- **测试能力提升**：
  - 开发智能测试用例生成
  - 增加边界条件测试
  - 支持多硬件平台验证

### 3.4 上下文转储不完整
- **问题描述**：算子开发 Agent 在开发过程中的上下文转储不完整（已识别解决方案但需要实施验证）
- **改进措施**：
  - 完善上下文捕获机制
  - 建立开发过程追踪
  - 开发调试信息收集

### 3.5 基础指标分析
- **问题描述**：指标 Agent 仅执行基础分析，缺少具体的测量模型或比较能力
- **分析能力增强**：
  - 建立多维评估指标体系
  - 开发性能基准测试
  - 实现跨算子对比分析

## 4. 框架与成本优化

### 4.1 框架限制
- **问题描述**：当前验证主要使用 Claude Code + Deepseek V3.2，需要评估替代的 Agent 框架和模型 API
- **评估方向**：
  - 测试其他开源 Agent 框架
  - 评估不同大语言模型表现
  - 建立框架选择标准

### 4.2 Token 消耗优化
- **问题描述**：AI Agent token 消耗显著 - 几天内 1600+ API 调用消耗了 51,923,051 tokens，成本约 ¥16+
- **优化策略**：
  - 开发 token 优化算法
  - 建立缓存机制
  - 优化提示词设计
  - 实施批量处理

## 5. 优先级与实施路线图

### 高优先级（1-2周）
- [ ] 修复基础示例代码编译问题
- [ ] 完善容器环境预配置
- [ ] 建立本地化文档镜像
- [ ] 优化 token 消耗策略

### 中优先级（1-2月）
- [ ] 开发智能测试用例生成
- [ ] 建立多维评估指标体系
- [ ] 扩展项目类型支持
- [ ] 完善上下文转储机制

### 长期规划（3-6月）
- [ ] 集成真实 NPU 测试环境
- [ ] 开发专用文档 MCP 服务
- [ ] 建立性能基准测试体系
- [ ] 支持复杂算子开发模板

## 6. 监控与改进机制

### 6.1 问题追踪
- 建立问题分类和优先级体系
- 定期回顾和更新问题状态
- 跟踪解决方案实施效果

### 6.2 性能监控
- 监控 Agent 开发效率指标
- 跟踪 token 消耗和成本
- 评估开发质量改进

### 6.3 持续改进
- 定期收集用户反馈
- 分析开发瓶颈
- 优化工作流程